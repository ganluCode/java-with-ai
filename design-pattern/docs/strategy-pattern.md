# 策略模式 (Strategy Pattern)

## 1. 模式简介

策略模式是一种行为设计模式，它定义了一系列算法，并将每种算法分别放入独立的类中，使算法的变化独立于使用它们的客户端。

### 1.1 别名
- 政策模式 (Policy Pattern)

### 1.2 意图
定义一系列算法，把它们一个个封装起来，并且使它们可相互替换。本模式使得算法可独立于使用它的客户端而变化。

### 1.3 核心思想
- 将算法族封装在独立的策略类中
- 使算法可以相互替换而不影响客户端
- 消除条件语句，提高代码的可维护性和可扩展性

## 2. 适用场景

- 许多相关的类仅仅是行为有异
- 需要使用一个算法的不同变体
- 算法使用数据客户端不应该知道的数据
- 一个类定义了多种行为，并且这些行为在这个类的操作中以多个条件语句的形式出现

## 3. 结构说明

### 3.1 主要角色

1. **Strategy（抽象策略类）**
   - 定义所有支持的算法的公共接口
   - 上下文使用这个接口来调用具体的策略定义的算法

2. **ConcreteStrategy（具体策略类）**
   - 实现了Strategy接口的具体算法
   - 每个具体策略类都提供了不同的算法实现

3. **Context（环境类）**
   - 用一个ConcreteStrategy对象来配置
   - 维护一个对Strategy对象的引用
   - 可定义一个接口来让Strategy访问它的数据

## 4. 优缺点

### 4.1 优点
- **算法可以自由切换**：客户端可以在运行时选择不同的算法
- **避免使用多重条件判断**：将算法封装在独立的类中，消除复杂的条件语句
- **扩展性良好**：增加新的算法只需增加新的策略类
- **符合开闭原则**：算法的增加和修改都不会影响原有代码

### 4.2 缺点
- **策略类数量增多**：每种算法都需要一个策略类
- **客户端必须知道所有的策略类**：客户端需要知道有哪些策略类并决定使用哪一个
- **可能产生对象数量增多**：所有策略对象都需实例化

## 5. 实际应用场景

1. **支付方式选择**：信用卡、支付宝、微信支付等不同支付策略
2. **排序算法**：快速排序、归并排序、堆排序等不同排序策略
3. **路径规划**：最短路径、最快路径、最少花费路径等不同导航策略
4. **数据压缩**：ZIP、RAR、7Z等不同压缩策略
5. **游戏AI**：简单AI、困难AI、专家AI等不同难度策略
6. **促销策略**：满减、折扣、赠品等不同促销策略
7. **缓存策略**：LRU、FIFO、LFU等不同缓存淘汰策略
8. **日志记录**：文件日志、数据库日志、远程日志等不同记录策略
9. **数据验证**：正则表达式、自定义规则等不同验证策略
10. **加密算法**：AES、RSA、DES等不同加密策略

## 6. 常见问题与解决方案

### 6.1 策略类数量膨胀问题
- **问题**：每种算法都需要一个策略类，导致类数量增多
- **解决方案**：
  1. 合理划分算法族，避免过度细化
  2. 使用模板方法模式减少重复代码
  3. 对于简单算法，可以考虑使用函数式接口

### 6.2 客户端选择策略的复杂性
- **问题**：客户端需要了解所有策略类并决定使用哪一个
- **解决方案**：
  1. 使用工厂模式或策略工厂简化策略选择
  2. 使用配置文件或注解指定策略
  3. 提供策略选择器或策略管理器

### 6.3 策略间共享数据问题
- **问题**：不同策略间可能需要共享数据或状态
- **解决方案**：
  1. 通过Context对象传递共享数据
  2. 使用观察者模式实现策略间通信
  3. 引入中介者模式管理复杂的数据交互

### 6.4 策略组合问题
- **问题**：需要组合多种策略来实现复杂功能
- **解决方案**：
  1. 创建组合策略类封装多个策略
  2. 使用装饰器模式动态添加策略
  3. 实现策略链模式顺序执行多个策略

## 7. 策略模式与其他模式的结合

### 7.1 与工厂模式的结合
- 使用工厂模式创建策略对象
- 集中管理策略对象的创建逻辑
- 简化客户端的策略选择过程

### 7.2 与单例模式的结合
- 对于无状态的策略对象，可以使用单例模式
- 减少对象创建开销，提高性能
- 避免不必要的对象实例化

### 7.3 与模板方法模式的结合
- 在抽象策略类中定义算法骨架
- 在具体策略类中实现特定步骤
- 减少重复代码，提高代码复用性

## 8. 现代应用

### 8.1 Java内置策略模式
Java SDK中大量使用了策略模式：
1. **Comparator接口**：不同的比较策略
2. **java.util.concurrent**：不同的并发策略
3. **IO流**：不同的数据处理策略

### 8.2 Spring框架中的策略模式
Spring框架广泛使用策略模式：
1. **Bean创建策略**：单例、原型等不同创建策略
2. **事务管理策略**：不同的事务管理方式
3. **安全认证策略**：不同的认证方式

### 8.3 函数式编程中的策略模式
在函数式编程中，可以使用函数作为策略：
1. **Lambda表达式**：替代策略类
2. **高阶函数**：接受函数作为参数
3. **函数组合**：组合不同的策略函数

## 9. 增强特性实现

### 9.1 策略工厂
通过策略工厂模式集中管理策略对象的创建，简化客户端使用。

### 9.2 策略选择器
提供智能化的策略选择机制，根据上下文自动选择最优策略。

### 9.3 无状态策略单例
对于无状态的策略对象，使用单例模式减少对象创建开销。

### 9.4 函数式策略
使用Lambda表达式和函数式接口替代传统的策略类，使代码更加简洁。

## 10. 总结

策略模式是处理算法族变化的有效设计模式，通过将算法封装为独立的对象，可以避免复杂的条件判断语句，使代码更加清晰和易于维护。在实际应用中，我们需要根据业务复杂度选择合适的实现方式，并注意处理好策略类数量控制、客户端选择复杂性等问题。现代Java开发中，结合工厂模式、单例模式以及函数式编程特性，可以让策略模式发挥更大的作用。